<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ztesoft.rail.dao.DownLoadDao">

  <!--#导出首页指标-->
  <select id="getfirstPage" resultType="map" parameterType="String">
    select a.community_name,b.city_name,
    IFNULL(CONCAT(ROUND(SUM(c.HTTP_KP2)/SUM(c.HTTP_KP1)*100,2),'%'),'--') HTTP_IND1,
    IFNULL(ROUND(SUM(c.HTTP_KP3)/SUM(c.HTTP_KP2)),'--') HTTP_IND2,
    IFNULL((CASE WHEN SUM(c.HTTP_KP8) = 0 THEN 0 ELSE ROUND(SUM(c.HTTP_KP7*8000)*1.0/SUM(c.HTTP_KP8*1024),2) END),'--')HTTP_IND5,
    IFNULL((CASE WHEN SUM(d.FTP_KP2) = 0 THEN 0 ELSE ROUND(SUM(d.FTP_KP1*8000)*1.0/SUM(d.FTP_KP2*1024),2) END),'--') FTP_IND1,
    IFNULL(CONCAT(ROUND(SUM(e.VIDEO_KP2)/SUM(e.VIDEO_KP1)*100,2),'%'),'--') VIDEO_IND1,
    IFNULL((CASE WHEN SUM(e.VIDEO_KP4) = 0 THEN 0 ELSE ROUND(SUM(e.VIDEO_KP3*8000)*1.0/SUM(e.VIDEO_KP4*1024),2) END),'--') VIDEO_IND2,
    IFNULL(CONCAT(ROUND(SUM(f.S1MME_KP2)/SUM(f.S1MME_KP1)*100,2),'%'),'--') S1MME_IND1,
    IFNULL(CONCAT(ROUND(SUM(f.S1MME_KP4)/SUM(f.S1MME_KP3)*100,2),'%'),'--') S1MME_IND2
    from hailway_community a
    left join hailway_city b on a.city_id = b.city_id
    left join hailway_http_h c on a.ci = c.ci and c.ACCT_NUMBER &gt;= #{startTime} and c.ACCT_NUMBER &lt;= #{endTime}
    left join hailway_ftp_h d on a.ci = d.ci and d.ACCT_NUMBER &gt;= #{startTime} and d.ACCT_NUMBER &lt;= #{endTime}
    left join hailway_video_h e on a.ci = e.ci and e.ACCT_NUMBER &gt;= #{startTime} and e.ACCT_NUMBER &lt;= #{endTime}
    left join hailway_s1mme_h f on a.ci = f.ci and f.ACCT_NUMBER &gt;= #{startTime} and f.ACCT_NUMBER &lt;= #{endTime}
    where a.line_id = #{lineId}
    group by a.CI order by b.city_name
  </select>

  <!--#导出volte指标-->
  <select id="getvoltePage" resultType="map" parameterType="String">

  </select>


</mapper>