<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ztesoft.rail.dao.IQuotaVoltePageDao">

	<!-- VOLTE附着阶段得分 -->
	<select id="getVolteAccrete" resultType="map">
		select sum(a.S1MME_KP1)
		quota1,sum(a.S1MME_KP2) quota2,sum(a.S1MME_KP3)
		quota3,sum(a.S1MME_KP4) quota4,b.city_name from
		hailway_s1mme_volte a
		inner join hailway_city b on a.c_city_code=b.city_id
		where
		a.ACCT_NUMBER &gt;=#{startTime} AND a.ACCT_NUMBER &lt;=#{endTime} and LINE_ID =#{railLine}
		group by a.c_city_code
		ORDER BY quota1 DESC LIMIT 5
	</select>

	<!-- IMS注冊階段得分 -->
	<select id="getImsRegister" resultType="map">
		select sum(a.VOLTE_KP9)
		quota1,sum(a.VOLTE_KP10) quota2,b.city_name from
		hailway_sip_volte a
		inner join hailway_city b on a.c_city_code=b.city_id
		where
		a.ACCT_NUMBER &gt;=#{startTime} and a.ACCT_NUMBER &lt;=#{endTime} and LINE_ID =#{railLine}
		group by a.c_city_code
		ORDER BY quota1 DESC LIMIT 5
	</select>

	<!-- VOLTE持續階段得分 -->
	<select id="getVolteContinue" resultType="map">
		select sum(a.VOLTE_KP1)
		quota1,sum(a.VOLTE_KP2) quota2,sum(a.VOLTE_KP3)
		quota3,sum(a.VOLTE_KP4) quota4,b.city_name from
		hailway_sip_volte a
		inner join hailway_city b on a.c_city_code=b.city_id
		where
		a.ACCT_NUMBER &gt;=#{startTime} and a.ACCT_NUMBER &lt;=#{endTime} and LINE_ID =#{railLine}
		group by a.c_city_code
		ORDER BY quota1 DESC LIMIT 5
	</select>

	<!--VOLTE持续时延 暫時改爲RTP丟包率 -->
	<select id="getVolteContinueTimeDelay" resultType="map">
		select
		sum(a.MOS_KP1) quota1,sum(a.MOS_KP2) quota2,b.city_name from
		hailway_mos_volte a inner join hailway_city b on
		a.c_city_code=b.city_id
		where a.ACCT_NUMBER &gt;=#{startTime} and
		a.ACCT_NUMBER &lt;=#{endTime} and LINE_ID =#{railLine}
		group by a.c_city_code
		ORDER BY quota1
		DESC LIMIT 5
	</select>

	<!--ESRVCC切换得分 -->
	<select id="getEsrvccSwitch" resultType="map">
		select sum(a.SV_KP1)
		quota1,sum(a.SV_KP2) quota2,b.city_name from
		hailway_sv_volte a inner
		join hailway_city b on a.c_city_code=b.city_id
		where
		a.ACCT_NUMBER
		&gt;=#{startTime} and a.ACCT_NUMBER &lt;=#{endTime} and LINE_ID =#{railLine}
		group by
		a.c_city_code
		ORDER BY quota1 DESC LIMIT 5
	</select>

	<!-- RRC連接得分 -->
	<select id="getRrcLogin" resultType="map">
		select sum(a.UU_KP1)
		quota1,sum(a.UU_KP2) quota2,b.city_name from
		hailway_rrc_volte a inner
		join hailway_city b on a.c_city_code=b.city_id
		where
		a.ACCT_NUMBER
		&gt;=#{startTime} and a.ACCT_NUMBER &lt;=#{endTime} and LINE_ID =#{railLine}
		group by
		a.c_city_code
		ORDER BY quota1 DESC LIMIT 5
	</select>

	<!--X2切换得分 -->
	<select id="getX2Switch" resultType="map">
		select sum(a.X2_KP1)
		quota1,sum(a.X2_KP2) quota2,b.city_name from
		hailway_x2_volte a inner
		join hailway_city b on a.c_city_code=b.city_id
		where
		a.ACCT_NUMBER
		&gt;=#{startTime} and a.ACCT_NUMBER &lt;=#{endTime} and LINE_ID =#{railLine}
		group by
		a.c_city_code
		ORDER BY quota1 DESC LIMIT 5
	</select>

	<!-- ****************查當前日期以前一周的數據********************* -->
	<!-- VOLTE附着阶段得分 -->
	<select id="getWeekVolteAccrete" resultType="map">
		SELECT
		SUM(S1MME_KP1) quota1,SUM(S1MME_KP2) quota2,SUM(S1MME_KP3)
		quota3,SUM(S1MME_KP4) quota4,STR_TO_DATE(ACCT_NUMBER,'%Y%m%d') time
		FROM
		hailway_s1mme_volte WHERE ACCT_NUMBER&lt;=#{endTime} and
		ACCT_NUMBER&gt;#{startTime} and LINE_ID =#{railLine} GROUP BY time
	</select>

	<!-- IMS注冊階段得分 -->
	<select id="getWeekImsRegister" resultType="map">
		SELECT
		SUM(VOLTE_KP9)
		quota1,SUM(VOLTE_KP10) quota2,STR_TO_DATE(ACCT_NUMBER,'%Y%m%d') time
		FROM
		hailway_sip_volte WHERE ACCT_NUMBER&lt;=#{endTime} and
		ACCT_NUMBER&gt;#{startTime} and LINE_ID =#{railLine} GROUP BY time
	</select>

	<!-- VOLTE持續階段得分 -->
	<select id="getWeekVolteContinue" resultType="map">
		SELECT
		SUM(VOLTE_KP1) quota1,SUM(VOLTE_KP2)
		quota2,SUM(VOLTE_KP3),SUM(VOLTE_KP4)
		quota4,STR_TO_DATE(ACCT_NUMBER,'%Y%m%d') time FROM
		hailway_sip_volte
		WHERE ACCT_NUMBER&lt;=#{endTime} and
		ACCT_NUMBER&gt;#{startTime} and LINE_ID =#{railLine} GROUP
		BY time
	</select>

	<!--VOLTE持续时延 暫時改爲RTP丟包率 -->
	<select id="getWeekVolteContinueTimeDelay" resultType="map">
		SELECT
		SUM(MOS_KP1) quota1,SUM(MOS_KP2)
		quota2,STR_TO_DATE(ACCT_NUMBER,'%Y%m%d') time FROM
		hailway_mos_volte
		WHERE ACCT_NUMBER&lt;=#{endTime} and
		ACCT_NUMBER&gt;#{startTime} and LINE_ID =#{railLine} GROUP
		BY time
	</select>

	<!--ESRVCC切换得分 -->
	<select id="getWeekEsrvccSwitch" resultType="map">
		SELECT
		SUM(SV_KP1)
		quota1,SUM(SV_kp2) quota2,STR_TO_DATE(ACCT_NUMBER,'%Y%m%d') time FROM
		hailway_sv_volte WHERE ACCT_NUMBER&lt;=#{endTime} and
		ACCT_NUMBER&gt;#{startTime} and LINE_ID =#{railLine} GROUP BY time
	</select>

	<!-- RRC連接得分 -->
	<select id="getWeekRrcLogin" resultType="map">
		SELECT
		SUM(UU_KP1)
		quota1,SUM(UU_KP2) quota2,STR_TO_DATE(ACCT_NUMBER,'%Y%m%d') time FROM
		hailway_rrc_volte WHERE ACCT_NUMBER&lt;=#{endTime} and
		ACCT_NUMBER&gt;#{startTime} and LINE_ID =#{railLine} GROUP BY time
	</select>

	<!--X2切换得分 -->
	<select id="getWeekX2Switch" resultType="map">
		SELECT
		SUM(X2_KP1)
		quota1,SUM(X2_KP2) quota2,STR_TO_DATE(ACCT_NUMBER,'%Y%m%d') time FROM
		hailway_x2_volte WHERE ACCT_NUMBER&lt;=#{endTime} and
		ACCT_NUMBER&gt;#{startTime} and LINE_ID =#{railLine} GROUP BY time
	</select>

<!-- 查询一周的数据按小时分组 *******************************************************-->
   <select id="getWeekVolteAccreteHour" parameterType="java.util.List" resultType="map">
		select 
		SUM(S1MME_KP1) quota1,SUM(S1MME_KP2) quota2,SUM(S1MME_KP3)
		quota3,SUM(S1MME_KP4) quota4,ACCT_NUMBER time from
		hailway_s1mme_volte
		<where>
			ACCT_NUMBER in
			<foreach item="quota" collection="quota" separator=","
				open="(" close=")" >
				#{quota}
			</foreach>
			and LINE_ID=#{railLine}
		</where>
		GROUP BY ACCT_NUMBER
	</select>

	<select id="getWeekImsRegisterHour" parameterType="java.util.List" resultType="map">
		select 
		SUM(VOLTE_KP1) quota1,SUM(VOLTE_KP2)
		quota2,ACCT_NUMBER time from
		hailway_sip_volte
		<where>
			ACCT_NUMBER in
			<foreach item="quota" collection="quota" separator=","
				open="(" close=")" >
				#{quota}
			</foreach>
			and LINE_ID=#{railLine}
		</where>
		GROUP BY ACCT_NUMBER
	</select>

	<select id="getWeekVolteContinueHour" parameterType="java.util.List" resultType="map">
		select 
		SUM(VOLTE_KP1) quota1,SUM(VOLTE_KP2)
		quota2,SUM(VOLTE_KP3),SUM(VOLTE_KP4)
		quota4,ACCT_NUMBER time from
		hailway_sip_volte
		<where>
			ACCT_NUMBER in
			<foreach item="quota" collection="quota" separator=","
				open="(" close=")" >
				#{quota}
			</foreach>
			and LINE_ID=#{railLine}
		</where>
		GROUP BY ACCT_NUMBER
	</select>


	<select id="getWeekVolteContinueTimeDelayHour" parameterType="java.util.List" resultType="map">
		select SUM(MOS_KP1) quota1,SUM(MOS_KP2)
		quota2,ACCT_NUMBER time from
		hailway_mos_volte
		<where>
			ACCT_NUMBER in
			<foreach item="quota" collection="quota" separator=","
				open="(" close=")" >
				#{quota}
			</foreach>
			and LINE_ID=#{railLine}
		</where>
		GROUP BY ACCT_NUMBER
	</select>



	<select id="getWeekEsrvccSwitcHour" parameterType="java.util.List" resultType="map">
		select SUM(SV_KP1)
		quota1,SUM(SV_kp2) quota2,ACCT_NUMBER time from
		hailway_sv_volte
		<where>
			ACCT_NUMBER in
			<foreach item="quota" collection="quota" separator=","
				open="(" close=")" >
				#{quota}
			</foreach>
			and LINE_ID=#{railLine}
		</where>
		GROUP BY ACCT_NUMBER
	</select>
	
	<select id="getWeekRrcLoginHour" parameterType="java.util.List" resultType="map">
		select SUM(UU_KP1)
		quota1,SUM(UU_KP2) quota2,ACCT_NUMBER time from
		hailway_rrc_volte
		<where>
			ACCT_NUMBER in
			<foreach item="quota" collection="quota" separator=","
				open="(" close=")" >
				#{quota}
			</foreach>
			and LINE_ID=#{railLine}
		</where>
		GROUP BY ACCT_NUMBER
	</select>
	
	<select id="getWeekX2SwitchHour" parameterType="java.util.List" resultType="map">
		select SUM(X2_KP1)
		quota1,SUM(X2_KP2) quota2,ACCT_NUMBER time from
		hailway_x2_volte
		<where>
			ACCT_NUMBER in
			<foreach item="quota" collection="quota" separator=","
				open="(" close=")" >
				#{quota}
			</foreach>
			and LINE_ID=#{railLine}
		</where>
		GROUP BY ACCT_NUMBER
	</select>
</mapper>