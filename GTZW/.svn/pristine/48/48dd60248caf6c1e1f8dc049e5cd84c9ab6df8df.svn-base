<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ztesoft.rail.dao.HailwayCommunityDao">

    <resultMap id="selAllHaiwayCommunity" type="com.ztesoft.rail.domain.HailwayCommunity">
        <id column="CI" property="ci"/>
        <result column="line_id" property="lineId"/>
        <result column="city_id" property="cityId"/>
        <result column="station_id" property="stationId"/>
        <result column="station_name" property="stationName"/>
        <result column="community_id" property="communityId"/>
        <result column="community_name" property="communityName"/>
        <result column="TAC" property="tac"/>
        <result column="RUID" property="ruid"/>
        <result column="RU_long" property="ruLong"/>
        <result column="RU_lat" property="ruLat"/>
        <result column="is_state" property="isState"/>
        <result column="state_id" property="stateId"/>
        <result column="order_num" property="orderNum"/>
    </resultMap>
<select id="lineData" resultMap="selAllHaiwayCommunity">
        SELECT * FROM hailway_community a
        WHERE a.line_id = #{lineId} and a.order_num > 0
        ORDER BY a.order_num;
</select>

<resultMap id="ResultMapData" type="com.ztesoft.rail.utils.PerformanceUtil">
    <result column="line_id" property="line"/>
    <result column="community_name" property="communityName"/>
    <result column="value" property="indexData"/>
</resultMap>


  <!--#HTTP-->
    <!--HTTP_IND1-->
<select id="dataIndex0" resultMap="ResultMapData">

        select a.community_name,CONCAT(ROUND(c.HTTP_KP2/c.HTTP_KP1*100,2),'%') value,
        ROUND(c.HTTP_KP2/c.HTTP_KP1*100,2) theRank
        from hailway_community a,hailway_http_h c
        where a.CI=c.CI
        <if test="startTime!=null">
            and c.ACCT_NUMBER &gt;= #{startTime}
        </if>
        <if test="endTime!=null">
            and c.ACCT_NUMBER &lt;= #{endTime}
        </if>
        <if test="line != null and line != ''">
            and a.line_id=#{line}
        </if>
    GROUP BY a.CI
    <if test="sequence == 'ASC'">
        ORDER BY theRank ASC
    </if>
    <if test="sequence == 'DESC'">
        ORDER BY theRank DESC
    </if>

</select>

   <!-- HTTP_IND2-->
    <select id="dataIndex1" resultMap="ResultMapData">

            select a.community_name,ROUND((HTTP_KP3)/(HTTP_KP2)) value from
            hailway_community a,hailway_http_h c
            where a.CI=c.CI
            <if test="startTime!=null">
                and c.ACCT_NUMBER &gt;= #{startTime}
            </if>
            <if test="endTime!=null">
                and c.ACCT_NUMBER &lt;= #{endTime}
            </if>
            <if test="line!=null">
                and a.line_id=#{line}
            </if>
        GROUP BY a.CI
        <if test="sequence == 'ASC'">
            ORDER BY value ASC
        </if>
        <if test="sequence == 'DESC'">
            ORDER BY value DESC
        </if>

    </select>

   <!-- HTTP_IND5-->
    <select id="dataIndex2" resultMap="ResultMapData">

            select a.community_name,
            (CASE WHEN SUM(HTTP_KP8) = 0 THEN 0 ELSE ROUND(SUM(HTTP_KP7*8000)*1.0/SUM(HTTP_KP8*1024),2) END) value from
            hailway_community a,hailway_http_h c
            where a.CI=c.CI
            <if test="startTime!=null">
                and c.ACCT_NUMBER &gt;= #{startTime}
            </if>
            <if test="endTime!=null">
                and c.ACCT_NUMBER &lt;= #{endTime}
            </if>
            <if test="line!=null">
                and a.line_id=#{line}
            </if>
            GROUP BY a.CI
            <if test="sequence == 'ASC'">
                ORDER BY value ASC
            </if>
            <if test="sequence == 'DESC'">
                ORDER BY value DESC
            </if>

    </select>

   <!-- #FTP-->
    <!--FTP_IND1-->
    <select id="dataIndex3" resultMap="ResultMapData">

            select a.community_name,
            (CASE WHEN SUM(FTP_KP2) = 0 THEN 0 ELSE ROUND(SUM(FTP_KP1*8000)*1.0/SUM(FTP_KP2*1024),2) END) value from
            hailway_community a,hailway_ftp_h c
            where a.CI=c.CI
            <if test="startTime!=null">
                and c.ACCT_NUMBER &gt;= #{startTime}
            </if>
            <if test="endTime!=null">
                and c.ACCT_NUMBER &lt;= #{endTime}
            </if>
            <if test="line!=null">
                and a.line_id=#{line}
            </if>
        GROUP BY a.CI
        <if test="sequence == 'ASC'">
            ORDER BY value ASC
        </if>
        <if test="sequence == 'DESC'">
            ORDER BY value DESC
        </if>

    </select>


   <!-- #IM-->
    <!--IM_IND1-->
    <select id="dataIndex4" resultMap="ResultMapData">

            select a.community_name,
            CONCAT(ROUND(IM_KP2/IM_KP1,2)*100,'%') value,
            ROUND(IM_KP2/IM_KP1,2)*100 theRank
            from hailway_community a,hailway_im_h c
            where a.CI=c.CI
            <if test="startTime!=null">
                and c.ACCT_NUMBER &gt;= #{startTime}
            </if>
            <if test="endTime!=null">
                and c.ACCT_NUMBER &lt;= #{endTime}
            </if>
            <if test="line!=null">
                and a.line_id=#{line}
            </if>
        GROUP BY a.CI
        <if test="sequence == 'ASC'">
            ORDER BY theRank ASC
        </if>
        <if test="sequence = 'DESC'">
            ORDER BY theRank DESC
        </if>

    </select>

    <!--IM_IND2-->
    <select id="dataIndex5" resultMap="ResultMapData">

            select a.community_name,
            (CASE WHEN SUM(IM_KP4) = 0 THEN 0 ELSE ROUND(SUM(IM_KP3*8000)*1.0/SUM(IM_KP4*1024),2) END) value from
            hailway_community a,hailway_im_h c
            where a.CI=c.CI
            <if test="startTime!=null">
                and c.ACCT_NUMBER &gt;= #{startTime}
            </if>
            <if test="endTime!=null">
                and c.ACCT_NUMBER &lt;= #{endTime}
            </if>
            <if test="line!=null">
                and a.line_id=#{line}
            </if>
        GROUP BY a.CI
        <if test="sequence == 'ASC'">
            ORDER BY value ASC
        </if>
        <if test="sequence == 'DESC'">
            ORDER BY value DESC
        </if>

    </select>
    <!--IM_IND3-->
    <select id="dataIndex6" resultMap="ResultMapData">

            select a.community_name,
            (CASE WHEN SUM(IM_KP6) = 0 THEN 0 ELSE ROUND(SUM(IM_KP5*8000)*1.0/SUM(IM_KP6*1024),2) END) value from
            hailway_community a,hailway_im_h c
            where a.CI=c.CI
            <if test="startTime!=null">
                and c.ACCT_NUMBER &gt;= #{startTime}
            </if>
            <if test="endTime!=null">
                and c.ACCT_NUMBER &lt;= #{endTime}
            </if>
            <if test="line!=null">
                and a.line_id=#{line}
            </if>
        GROUP BY a.CI
        <if test="sequence == 'ASC'">
            ORDER BY value ASC
        </if>
        <if test="sequence == 'DESC'">
            ORDER BY value DESC
        </if>

    </select>

  <!-- VIDEO-->
    <!--视频播放成功率-->
    <!--VIDEO_IND1-->
    <select id="dataIndex7" resultMap="ResultMapData" >

            select a.community_name,
            CONCAT(ROUND(VIDEO_KP2/VIDEO_KP1,2)*100,'%') value ,
            ROUND(VIDEO_KP2/VIDEO_KP1,2)*100 theRank
            from hailway_community a,hailway_video_h c
            where a.CI=c.CI
            <if test="startTime!=null">
                and c.ACCT_NUMBER &gt;= #{startTime}
            </if>
            <if test="endTime!=null">
                and c.ACCT_NUMBER &lt;= #{endTime}
            </if>
            <if test="line!=null">
                and a.line_id=#{line}
            </if>
        GROUP BY a.CI
        <if test="sequence == 'ASC'">
            ORDER BY theRank ASC
        </if>
        <if test="sequence == 'DESC'">
            ORDER BY theRank DESC
        </if>

    </select>

   <!-- 视频下载率-->
   <!-- VIDEO_IND2-->
    <select id="dataIndex8" resultMap="ResultMapData">

            select a.community_name,
            (CASE WHEN SUM(VIDEO_KP4) = 0 THEN 0 ELSE ROUND(SUM(VIDEO_KP3*8000)*1.0/SUM(VIDEO_KP4*1024),2) END) value from
            hailway_community a,hailway_video_h c
            where a.CI=c.CI
            <if test="startTime!=null">
                and c.ACCT_NUMBER &gt;= #{startTime}
            </if>
            <if test="endTime!=null">
                and c.ACCT_NUMBER &lt;= #{endTime}
            </if>
            <if test="line!=null">
                and a.line_id=#{line}
            </if>
        GROUP BY a.CI
        <if test="sequence == 'ASC'">
            ORDER BY value ASC
        </if>
        <if test="sequence == 'DESC'">
            ORDER BY value DESC
        </if>

    </select>

    <!--RRC连击率-->
   <!-- UU_IND1-->
    <select id="dataIndex9" resultMap="ResultMapData">

            select a.community_name,
            CONCAT(ROUND(UU_KP2/UU_KP1,2)*100,'%') value ,
            ROUND(UU_KP2/UU_KP1,2)*100 theRank
            from hailway_community a,hailway_uu_h c
            where a.CI=c.CI
            <if test="startTime!=null">
                and c.ACCT_NUMBER &gt;= #{startTime}
            </if>
            <if test="endTime!=null">
                and c.ACCT_NUMBER &lt;= #{endTime}
            </if>
            <if test="line!=null">
                and a.line_id=#{line}
            </if>
        GROUP BY a.CI
        <if test="sequence == 'ASC'">
            ORDER BY theRank ASC
        </if>
        <if test="sequence == 'DESC'">
            ORDER BY theRank DESC
        </if>

    </select>

  <!--Simme-->
    <!--S1MME_IND1-->
    <select id="dataIndex10" resultMap="ResultMapData">

            select a.community_name,CONCAT(ROUND(SUM(S1MME_KP2)/SUM(S1MME_KP1),2)*100,'%') value,
            ROUND(SUM(S1MME_KP2)/SUM(S1MME_KP1),2)*100 theRank
            from hailway_community a,hailway_s1mme_h c
            where a.CI=c.CI
            <if test="startTime!=null">
                and c.ACCT_NUMBER &gt;= #{startTime}
            </if>
            <if test="endTime!=null">
                and c.ACCT_NUMBER &lt;= #{endTime}
            </if>
            <if test="line!=null">
                and a.line_id=#{line}
            </if>
        GROUP BY a.CI
        <if test="sequence == 'ASC'">
            ORDER BY theRank ASC
        </if>
        <if test="sequence == 'DESC'">
            ORDER BY theRank DESC
        </if>

    </select>
    <!--S1MME_IND2-->
    <select id="dataIndex11" resultMap="ResultMapData">

            select a.community_name,CONCAT(ROUND(S1MME_KP4/S1MME_KP3,2)*100,'%') value ,
            ROUND(S1MME_KP4/S1MME_KP3,2)*100 theRank
            from hailway_community a,hailway_s1mme_h c
            where a.CI=c.CI
            <if test="startTime!=null">
                and c.ACCT_NUMBER &gt;= #{startTime}
            </if>
            <if test="endTime!=null">
                and c.ACCT_NUMBER &lt;= #{endTime}
            </if>
            <if test="line!=null">
                and a.line_id=#{line}
            </if>
        GROUP BY a.CI
        <if test="sequence == 'ASC'">
            ORDER BY theRank ASC
        </if>
        <if test="sequence == 'DESC'">
            ORDER BY theRank DESC
        </if>

    </select>

   <!-- S1MME_IND1_VOLTE-->
    <select id="VoltedataIndex0" resultMap="ResultMapData">
        SELECT b.community_name,CONCAT(ROUND(sum(a.S1MME_KP2)/sum(a.S1MME_KP1),3)*100,'%') value,
        sum(a.S1MME_KP2)/sum(a.S1MME_KP1) theRank
        FROM hailway_s1mme_volte a
        inner join hailway_community b on a.CI=b.CI
        <if test="startTime!=null">
            and a.ACCT_NUMBER &gt;= #{startTime}
        </if>
        <if test="endTime!=null">
            and a.ACCT_NUMBER &lt;= #{endTime}
        </if>
        <if test="line!=null">
            and b.line_id=#{line}
        </if>
        GROUP BY a.CI
        <if test="sequence == 'ASC'">
            ORDER BY theRank ASC
        </if>
        <if test="sequence == 'DESC'">
            ORDER BY theRank DESC
        </if>
    </select>

    <!--S1MME_IND2_VOLTE-->
    <select id="VoltedataIndex1" resultMap="ResultMapData">
        SELECT b.community_name,CONCAT(ROUND(sum(a.S1MME_KP4)/sum(a.S1MME_KP3),3)*100,'%') value,
        sum(a.S1MME_KP4)/sum(a.S1MME_KP3) theRank
        FROM hailway_s1mme_volte a
        inner join hailway_community b on a.CI=b.CI
        <if test="startTime!=null">
            and a.ACCT_NUMBER &gt;= #{startTime}
        </if>
        <if test="endTime!=null">
            and a.ACCT_NUMBER &lt;= #{endTime}
        </if>
        <if test="line!=null">
            and b.line_id=#{line}
        </if>
        GROUP BY a.CI
        <if test="sequence == 'ASC'">
            ORDER BY theRank ASC
        </if>
        <if test="sequence == 'DESC'">
            ORDER BY theRank DESC
        </if>
    </select>

    <!--VOLTE_IND5-->
    <select id="VoltedataIndex2" resultMap="ResultMapData">
        SELECT b.community_name,CONCAT(ROUND(sum(a.VOLTE_KP10)/sum(a.VOLTE_KP9),3)*100,'%') value,
        sum(a.VOLTE_KP10)/sum(a.VOLTE_KP9) theRank
        FROM hailway_sip_volte a
        inner join hailway_community b
        on a.CI=b.CI
        <if test="startTime!=null">
            and a.ACCT_NUMBER &gt;= #{startTime}
        </if>
        <if test="endTime!=null">
            and a.ACCT_NUMBER &lt;= #{endTime}
        </if>
        <if test="line!=null">
            and b.line_id=#{line}
        </if>
        GROUP BY a.CI
        <if test="sequence == 'ASC'">
            ORDER BY theRank ASC
        </if>
        <if test="sequence == 'DESC'">
            ORDER BY theRank DESC
        </if>
    </select>

    <!--VOLTE_IND1-->
    <select id="VoltedataIndex3" resultMap="ResultMapData">
        SELECT b.community_name,CONCAT(ROUND(sum(a.VOLTE_KP2)/sum(a.VOLTE_KP1),3)*100,'%') value,
        sum(a.VOLTE_KP2)/sum(a.VOLTE_KP1) theRank
        FROM hailway_sip_volte a
        inner join hailway_community b
        on a.CI=b.CI
        <if test="startTime!=null">
            and a.ACCT_NUMBER &gt;= #{startTime}
        </if>
        <if test="endTime!=null">
            and a.ACCT_NUMBER &lt;= #{endTime}
        </if>
        <if test="line!=null">
            and b.line_id=#{line}
        </if>
        GROUP BY a.CI
        <if test="sequence == 'ASC'">
            ORDER BY theRank ASC
        </if>
        <if test="sequence == 'DESC'">
            ORDER BY theRank DESC
        </if>
    </select>

   <!-- VOLTE_IND2-->
    <select id="VoltedataIndex4" resultMap="ResultMapData">
        SELECT b.community_name,CONCAT(ROUND(sum(a.VOLTE_KP4)/sum(a.VOLTE_KP3),3)*100,'%') value,
        sum(a.VOLTE_KP4)/sum(a.VOLTE_KP3) theRank
        FROM hailway_sip_volte a
        inner join hailway_community b
        on a.CI=b.CI
        <if test="startTime!=null">
            and a.ACCT_NUMBER &gt;= #{startTime}
        </if>
        <if test="endTime!=null">
            and a.ACCT_NUMBER &lt;= #{endTime}
        </if>
        <if test="line!=null">
            and b.line_id=#{line}
        </if>
        GROUP BY a.CI
        <if test="sequence == 'ASC'">
            ORDER BY theRank ASC
        </if>
        <if test="sequence == 'DESC'">
            ORDER BY theRank DESC
        </if>
    </select>

   <!-- SV_IND1-->
    <select id="VoltedataIndex5" resultMap="ResultMapData">
        SELECT b.community_name, CONCAT(ROUND(sum(a.SV_KP2)/sum(a.SV_KP1),3)*100,'%') value,
        sum(a.SV_KP2)/sum(a.SV_KP1) theRank
        FROM hailway_sv_volte a
        inner join hailway_community b on a.CI=b.CI
        <if test="startTime!=null">
            and a.ACCT_NUMBER &gt;= #{startTime}
        </if>
        <if test="endTime!=null">
            and a.ACCT_NUMBER &lt;= #{endTime}
        </if>
        <if test="line!=null">
            and b.line_id=#{line}
        </if>
        GROUP BY a.CI
        <if test="sequence == 'ASC'">
            ORDER BY theRank ASC
        </if>
        <if test="sequence == 'DESC'">
            ORDER BY theRank DESC
        </if>
    </select>

    <!--MOS_IND1-->
    <select id="VoltedataIndex6" resultMap="ResultMapData">
        SELECT b.community_name, CONCAT(ROUND(sum(a.MOS_KP2)/sum(a.MOS_KP1),3)*100,'%') value,
        sum(a.MOS_KP2)/sum(a.MOS_KP1) theRank
        FROM hailway_mos_volte a
        inner join hailway_community b on a.CI=b.CI
        <if test="startTime!=null">
            and a.ACCT_NUMBER &gt;= #{startTime}
        </if>
        <if test="endTime!=null">
            and a.ACCT_NUMBER &lt;= #{endTime}
        </if>
        <if test="line!=null">
            and b.line_id=#{line}
        </if>
        GROUP BY a.CI
        <if test="sequence == 'ASC'">
            ORDER BY theRank ASC
        </if>
        <if test="sequence == 'DESC'">
            ORDER BY theRank DESC
        </if>
    </select>

   <!-- UU_IND1-->
    <select id="VoltedataIndex7" resultMap="ResultMapData">
        SELECT b.community_name, CONCAT(ROUND(sum(a.UU_KP2)/sum(a.UU_KP1),3)*100,'%') value,
        sum(a.UU_KP2)/sum(a.UU_KP1) theRank
        FROM hailway_rrc_volte a
        inner join hailway_community b on a.CI=b.CI
        <if test="startTime!=null">
            and a.ACCT_NUMBER &gt;= #{startTime}
        </if>
        <if test="endTime!=null">
            and a.ACCT_NUMBER &lt;= #{endTime}
        </if>
        where 1=1
        <if test="line!=null">
            and b.line_id=#{line}
        </if>
        GROUP BY a.CI
        <if test="sequence == 'ASC'">
            ORDER BY theRank ASC
        </if>
        <if test="sequence == 'DESC'">
            ORDER BY theRank DESC
        </if>
    </select>

    <!--X2_IND1-->
    <select id="VoltedataIndex8" resultMap="ResultMapData">
        SELECT b.community_name, CONCAT(ROUND(sum(a.X2_KP2)/sum(a.X2_KP1),3)*100,'%') value,
        sum(a.X2_KP2)/sum(a.X2_KP1) theRank
        FROM hailway_x2_volte a
        inner join hailway_community b on a.CI=b.CI
        <if test="startTime!=null">
            and a.ACCT_NUMBER &gt;= #{startTime}
        </if>
        <if test="endTime!=null">
            and a.ACCT_NUMBER &lt;= #{endTime}
        </if>
        <if test="line!=null">
            and b.line_id=#{line}
        </if>
        GROUP BY a.CI
        <if test="sequence == 'ASC'">
            ORDER BY theRank ASC
        </if>
        <if test="sequence == 'DESC'">
            ORDER BY theRank DESC
        </if>
    </select>



</mapper>