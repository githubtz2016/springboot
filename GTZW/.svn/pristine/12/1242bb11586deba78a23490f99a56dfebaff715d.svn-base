<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ztesoft.rail.dao.SceneMonitorDao">

    <!--查询4g用户数-->
    <select id="get4Guser" parameterType="String" resultType="map">
        select sum(USER_COUNT) userNum
        from hailway_s1mme_h
        WHERE ACCT_NUMBER = #{time}
    </select>

    <!--查询volte活跃用户数和话务量-->
    <select id="getVolteData" parameterType="String" resultType="map">
        SELECT
            sum( volte_kp11 ) volteUser,
            sum( volte_kp12 ) volteERL
        FROM
            hailway_sip_volte
        WHERE
            ACCT_NUMBER = #{time}
    </select>

    <!--查询总流量-->
    <select id="getSumFlow" parameterType="String" resultType="map">
        SELECT
	        sum( flow ) flowTotal
        FROM
            hailway_sumflow
        WHERE
            ACCT_NUMBER = #{time}
    </select>

    <!--查x2切换得分-->
    <select id="getX2Switch" resultType="map" parameterType="String">
        SELECT CONCAT(ROUND(sum(X2_KP2)/sum(X2_KP1)*100,2),'') X2_IND1
        FROM hailway_x2_volte
        WHERE  ACCT_NUMBER = #{time}
    </select>

    <!--无线掉线率-->
    <select id="getWLANlose" resultType="map" parameterType="String">
        SELECT CONCAT(ROUND(sum(S1MME_KP5 )/sum(S1MME_KP6 )*100,2),'') S1MME_IND4
        FROM hailway_s1mme_h
        WHERE  ACCT_NUMBER = #{time}
    </select>

    <!--VOLTE网络接通率-->
    <select id="getVolteNet" resultType="map" parameterType="String">
        SELECT CONCAT(ROUND(sum(VOLTE_KP2)/sum(VOLTE_KP1)*100,2),'') VOLTE_IND1
        FROM hailway_sip_volte
        WHERE  ACCT_NUMBER = #{time}
    </select>

    <!--HTTP下载速率(kbps)-->
    <select id="getHttpIndex" resultType="map" parameterType="String">
        SELECT (CASE WHEN SUM(HTTP_KP8) = 0 THEN 0 ELSE ROUND(SUM(HTTP_KP7*8000)*1.0/SUM(HTTP_KP8*1024),2) END) HTTP_IND5
        FROM hailway_http_h
        where ACCT_NUMBER = #{time}
    </select>

    <!--无线利用率（%）-->
    <select id="getWLAN" resultType="map" parameterType="String">
        SELECT
            CONCAT(round( SUM(a.CMR_KP2 + a.CMR_KP4 ) /SUM(a.CMR_KP1 + a.CMR_KP3 )*100, 2 ),'%' ) wlan,
            c.city_name
        FROM
            hailway_mr_mi a,
            hailway_community b,
            hailway_city c
        WHERE
            a.CI = b.CI
            AND b.city_id = c.city_id
            AND ACCT_NUMBER = #{time}
        GROUP BY c.city_id
    </select>

    <!--高流量车站用户数-->
    <select id="getStation" resultType="map" parameterType="String">
        SELECT
            SUM( USER_COUNT ) userNum,
            state_name
        FROM
            hailway_s1mme_h a,
            hailway_community b,
            hailway_state c
        WHERE
            a.ci = b.ci
            AND b.state_id IS NOT NULL
            AND a.ACCT_NUMBER = #{time}
            AND c.state_id = b.state_id
        GROUP BY
            b.state_id
    </select>

    <!--高铁用户变化趋势-->
    <select id="getUserChange" parameterType="String" resultType="map">
        SELECT
            SUM( a.USER_COUNT ) userNum,
            b.NAME line
        FROM
            hailway_s1mme_h a,
            hailway_line b
        WHERE
            a.LINE_ID = b.LINE_ID
            AND a.ACCT_NUMBER = #{time}
        GROUP BY
            a.LINE_ID
        ORDER BY a.LINE_ID
    </select>
</mapper>