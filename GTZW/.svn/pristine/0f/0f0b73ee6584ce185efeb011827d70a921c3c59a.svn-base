<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ztesoft.rail.dao.VolteIndexDao">

  <!--#根据线路查VOLTE附着阶段得分-->
  <select id="getVolteAccrete" resultType="map" parameterType="String">
    SELECT CONCAT(ROUND(sum(S1MME_KP2)/sum(S1MME_KP1)*100,2),'%') S1MME_IND1,
    CONCAT(ROUND(sum(S1MME_KP4)/sum(S1MME_KP3)*100,2),'%') S1MME_IND2
    FROM hailway_s1mme_volte
    WHERE  ACCT_NUMBER &gt;= #{startTime} and ACCT_NUMBER &lt;= #{endTime}
    and LINE_ID = #{lineId}
  </select>

  <!--#根据线路查VOLTE持续阶段得分-->
  <select id="getVolteContinue" resultType="map" parameterType="String">
    SELECT CONCAT(ROUND(sum(VOLTE_KP10)/sum(VOLTE_KP9)*100,2),'%') VOLTE_IND5,
    CONCAT(ROUND(sum(VOLTE_KP2)/sum(VOLTE_KP1)*100,2),'%') VOLTE_IND1,
    CONCAT(ROUND(sum(VOLTE_KP4)/sum(VOLTE_KP3)*100,2),'%') VOLTE_IND2
    FROM hailway_sip_volte
    WHERE  ACCT_NUMBER &gt;= #{startTime} and ACCT_NUMBER &lt;= #{endTime}
    and LINE_ID = #{lineId}
  </select>

  <!--#根据线路查MOS-->
  <select id="getMOS" resultType="map" parameterType="String">
    SELECT CONCAT(ROUND(sum(MOS_KP2)/sum(MOS_KP1)*100,2),'%') MOS_IND1
    FROM hailway_mos_volte
    WHERE  ACCT_NUMBER &gt;= #{startTime} and ACCT_NUMBER &lt;= #{endTime}
    and LINE_ID = #{lineId}
  </select>

  <!--#根据线路ESRVCC切换得分-->
  <select id="getESRVCCSwitch" resultType="map" parameterType="String">
    SELECT CONCAT(ROUND(sum(SV_KP2)/sum(SV_KP1)*100,2),'%') SV_IND1
    FROM hailway_sv_volte
    WHERE  ACCT_NUMBER &gt;= #{startTime} and ACCT_NUMBER &lt;= #{endTime}
    and LINE_ID = #{lineId}
  </select>


  <!--#根据线路查RRC连接得分-->
  <select id="getRRCLogin" resultType="map" parameterType="String">
    SELECT CONCAT(ROUND(sum(UU_KP2)/sum(UU_KP1)*100,2),'%') UU_IND1
    FROM hailway_rrc_volte
    WHERE  ACCT_NUMBER &gt;= #{startTime} and ACCT_NUMBER &lt;= #{endTime}
    and LINE_ID = #{lineId}
  </select>

  <!--#根据线路查x2切换得分-->
  <select id="getX2Switch" resultType="map" parameterType="String">
    SELECT CONCAT(ROUND(sum(X2_KP2)/sum(X2_KP1)*100,2),'%') X2_IND1
    FROM hailway_x2_volte
    WHERE  ACCT_NUMBER &gt;= #{startTime} and ACCT_NUMBER &lt;= #{endTime}
    and LINE_ID = #{lineId}
  </select>

  <!--x2切换成功率详情 -->
  <select id="getX2SwitchInfo" resultType="map">
    select a.community_name,b.city_name,CONCAT(ROUND(sum(c.X2_KP2)/sum(c.X2_KP1)*100,2),'%') percent,SUM(c.X2_KP2)/SUM(c.X2_KP1) theRank from
    hailway_community a,hailway_city b,hailway_x2_volte c
    where  a.city_id = b.city_id and c.CI= a.CI
    <if test="startTime!=null and startTime!=''">
      and c.ACCT_NUMBER &gt;= #{startTime} and c.ACCT_NUMBER &lt;= #{endTime}
    </if>
    <if test="lineId !=null and lineId !=''">
      and a.line_id = #{lineId}
    </if>
    group by a.CI ORDER BY theRank DESC LIMIT 10
  </select>

  <!--ESRVCC切换成功率详情 -->
  <select id="getESRVCCInfo" resultType="map">
    select a.community_name,b.city_name,CONCAT(ROUND(sum(c.SV_KP2)/sum(c.SV_KP1)*100,2),'%') percent,SUM(c.SV_KP2)/SUM(c.SV_KP1) theRank from
    hailway_community a,hailway_city b,hailway_sv_volte c
    where  a.city_id = b.city_id and c.CI= a.CI
    <if test="startTime!=null and startTime!=''">
      and c.ACCT_NUMBER &gt;= #{startTime} and c.ACCT_NUMBER &lt;= #{endTime}
    </if>
    <if test="lineId !=null and lineId !=''">
      and a.line_id = #{lineId}
    </if>
    group by a.CI ORDER BY theRank DESC LIMIT 10
  </select>

  <!--RTP丢包率详情 -->
  <select id="getRTPInfo" resultType="map">
    select a.community_name,b.city_name,CONCAT(ROUND(sum(c.MOS_KP2)/sum(c.MOS_KP1)*100,2),'%') percent,SUM(c.MOS_KP2)/SUM(c.MOS_KP1) theRank from
    hailway_community a,hailway_city b,hailway_mos_volte c
    where  a.city_id = b.city_id and c.CI= a.CI
    <if test="startTime!=null and startTime!=''">
      and c.ACCT_NUMBER &gt;= #{startTime} and c.ACCT_NUMBER &lt;= #{endTime}
    </if>
    <if test="lineId !=null and lineId !=''">
      and a.line_id = #{lineId}
    </if>
    group by a.CI ORDER BY theRank DESC LIMIT 10
  </select>

  <!--VOLTE持续阶段详情 -->
  <select id="getVolteContinueInfo" resultType="map">
    select a.community_name,b.city_name,
    CONCAT(ROUND(sum(c.VOLTE_KP2)/sum(c.VOLTE_KP1)*50 + sum(c.VOLTE_KP4)/sum(c.VOLTE_KP3)*50,2),'%') percent,
    SUM(c.VOLTE_KP2)/SUM(c.VOLTE_KP1)+sum(c.VOLTE_KP4)/sum(c.VOLTE_KP3) theRank from
    hailway_community a,hailway_city b,hailway_sip_volte c
    where  a.city_id = b.city_id and c.CI= a.CI
    <if test="startTime!=null and startTime!=''">
      and c.ACCT_NUMBER &gt;= #{startTime} and c.ACCT_NUMBER &lt;= #{endTime}
    </if>
    <if test="lineId !=null and lineId !=''">
      and a.line_id = #{lineId}
    </if>
    group by a.CI ORDER BY theRank DESC LIMIT 10
  </select>

  <!--VOLTE附着阶段详情 -->
  <select id="getVolteAccreteInfo" resultType="map">
    select a.community_name,b.city_name,
    CONCAT(ROUND(sum(c.S1MME_KP2)/sum(c.S1MME_KP1)*50 + sum(c.S1MME_KP4)/sum(c.S1MME_KP3)*50,2),'%') percent,
    SUM(c.S1MME_KP2)/SUM(c.S1MME_KP1)+sum(c.S1MME_KP4)/sum(c.S1MME_KP3) theRank from
    hailway_community a,hailway_city b,hailway_s1mme_volte c
    where  a.city_id = b.city_id and c.CI= a.CI
    <if test="startTime!=null and startTime!=''">
      and c.ACCT_NUMBER &gt;= #{startTime} and c.ACCT_NUMBER &lt;= #{endTime}
    </if>
    <if test="lineId !=null and lineId !=''">
      and a.line_id = #{lineId}
    </if>
    group by a.CI ORDER BY theRank DESC LIMIT 10
  </select>

  <!--IMS注冊階段详情 -->
  <select id="getImsRegisterInfo" resultType="map">
    select a.community_name,b.city_name,CONCAT(ROUND(sum(c.VOLTE_KP10)/sum(c.VOLTE_KP9)*100,2),'%') percent,SUM(c.VOLTE_KP10)/SUM(c.VOLTE_KP9) theRank from
    hailway_community a,hailway_city b,hailway_sip_volte c
    where  a.city_id = b.city_id and c.CI= a.CI
    <if test="startTime!=null and startTime!=''">
      and c.ACCT_NUMBER &gt;= #{startTime} and c.ACCT_NUMBER &lt;= #{endTime}
    </if>
    <if test="lineId !=null and lineId !=''">
      and a.line_id = #{lineId}
    </if>
    group by a.CI ORDER BY theRank DESC LIMIT 10
  </select>


</mapper>